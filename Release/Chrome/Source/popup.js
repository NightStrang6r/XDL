let menu=document.getElementById("menu"),checkboxes=document.getElementsByClassName("custom-checkbox"),loginButton=document.getElementById("login-button"),emailButton=document.getElementById("email-button"),emaitInput=document.getElementById("email-input"),settingsMenu=document.getElementById("settings-menu"),settingsButton=document.getElementById("settings-button"),attendanceTimeout=document.getElementById("attendance-timeout"),settings=new Object;chrome.runtime.onMessage.addListener(onMessage),restoreSettings(),sendLoginStateRequest();for(let e=0;e<checkboxes.length;e++)checkboxes[e].addEventListener("input",saveSettings);function restoreSettings(){chrome.runtime.sendMessage({greeting:"getSettings"},function(e){settings=e.settings;for(let e=0;e<checkboxes.length;e++)"true"==settings[`${checkboxes[e].name}`]?checkboxes[e].checked=!0:checkboxes[e].checked=!1;emaitInput.value=settings.email,attendanceTimeout.value=settings.attendanceTimeout})}function sendLoginStateRequest(){chrome.runtime.sendMessage({greeting:"checkLoginState"})}function setLoginState(e){let t=document.getElementById("main"),n=document.getElementById("no-login");e||$("#main").fadeOut(200,()=>{t.classList.add("no-view"),n.classList.remove("no-view")})}function saveSettings(e){for(let e=0;e<checkboxes.length;e++)settings[checkboxes[e].name]=checkboxes[e].checked;void 0===emaitInput.value&&(settings.email=emaitInput.value),"visitNotify"==e.srcElement.name&&1==e.srcElement.checked&&updateEmailInput(),chrome.runtime.sendMessage({greeting:"saveSettings",settings:settings},msgUI)}function saveEmailInput(){let e=emaitInput.value;chrome.runtime.sendMessage({greeting:"saveEmail",email:e})}function saveAttendanceTimeoutInput(){let e=+attendanceTimeout.value;chrome.runtime.sendMessage({greeting:"saveAttendanceTimeout",timeout:e})}function msgUI(e){document.getElementById("res")&&($("#res").fadeIn(1),document.getElementById("res").innerHTML=e.farewell,setTimeout(()=>{$("#res").fadeOut(800)},500))}function viewSettingsUI(e){let t=document.getElementById("main"),n=document.getElementById("no-login"),s=document.getElementById("settings");e?(t.classList.add("no-view"),n.classList.add("no-view"),s.classList.remove("no-view")):(t.classList.remove("no-view"),s.classList.add("no-view"))}function getArrString(e){let t="";for(var n in e)t+="Ключ: "+n+" значение: "+e[n]+"\n";return t}function updateEmailInput(){let e=$(".text-field")[0];emailButton.classList.toggle("arrow-top"),emailButton.classList.toggle("arrow-bottom"),"none"==e.style.display?e.style.display="block":e.style.display="none"}function goToLogin(){chrome.tabs.create({url:"https://dl.nure.ua/login/"})}function showMenuUI(){document.getElementById("myDropdown").classList.toggle("show")}function closeMenuIU(e){if(!e.target.matches(".dropbtn")){let e,t=document.getElementsByClassName("dropdown-content");for(e=0;e<t.length;e++){let n=t[e];n.classList.contains("show")&&n.classList.remove("show")}}}function onMessage(e,t,n){"setLoginState"==e.greeting&&setLoginState(e.state)}menu.addEventListener("click",showMenuUI),window.onclick=(e=>{closeMenuIU(e)}),loginButton.addEventListener("click",goToLogin),emailButton.addEventListener("click",updateEmailInput),emaitInput.addEventListener("input",saveEmailInput),settingsMenu.addEventListener("click",()=>viewSettingsUI(!0)),settingsButton.addEventListener("click",()=>viewSettingsUI(!1)),attendanceTimeout.addEventListener("input",saveAttendanceTimeoutInput);